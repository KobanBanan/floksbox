@echo off
chcp 65001 >nul
echo üöÄ –ó–∞–ø—É—Å–∫ FloksBox Full Stack Application...
echo =================================================

:: –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–∫—Ä–∏–ø—Ç–∞
cd /d "%~dp0"
echo üìç –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: %cd%
echo.

:: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–∞ –ø–æ—Ä—Ç–∞—Ö
echo üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤...
for /f "tokens=5" %%a in ('netstat -aon ^| find ":8000" ^| find "LISTENING"') do (
    echo ‚ö†Ô∏è  –ó–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 8000 (PID: %%a)
    taskkill /F /PID %%a >nul 2>&1
)
for /f "tokens=5" %%b in ('netstat -aon ^| find ":3000" ^| find "LISTENING"') do (
    echo ‚ö†Ô∏è  –ó–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 3000 (PID: %%b)
    taskkill /F /PID %%b >nul 2>&1
)
timeout /t 2 /nobreak >nul
echo.

:: –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ Python –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
if exist "venv" (
    echo üêç –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è Python...
    if exist "venv\Scripts\activate.bat" (
        call venv\Scripts\activate.bat
        echo ‚úÖ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ
    ) else (
        echo ‚ùå –§–∞–π–ª –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ venv\Scripts\activate.bat
        goto :error
    )
) else (
    echo ‚ö†Ô∏è  –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π Python
)
echo.

:: –ó–∞–ø—É—Å–∫ –±—ç–∫–µ–Ω–¥–∞
echo üîß –ó–∞–ø—É—Å–∫ Backend (Django)...
echo ================================
cd backend

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
if exist "requirements.txt" (
    echo üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Python...
    pip install -r requirements.txt
    if errorlevel 1 (
        echo ‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Python
        goto :error
    )
)

:: –í—ã–ø–æ–ª–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏
echo üóÑÔ∏è  –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π Django...
python manage.py makemigrations
python manage.py migrate
if errorlevel 1 (
    echo ‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
    goto :error
)

:: –ó–∞–ø—É—Å–∫–∞–µ–º backend –≤ —Ñ–æ–Ω–µ
echo üåê –ó–∞–ø—É—Å–∫ Django —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ http://localhost:8000
start /b cmd /c "python manage.py runserver 0.0.0.0:8000"

:: –ü–µ—Ä–µ—Ö–æ–¥–∏–º –æ–±—Ä–∞—Ç–Ω–æ –≤ –∫–æ—Ä–µ–Ω—å
cd ..
echo.

:: –ó–∞–ø—É—Å–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
echo ‚öõÔ∏è  –ó–∞–ø—É—Å–∫ Frontend (Nuxt.js)...
echo =================================
cd frontend

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º Node.js
node --version >nul 2>&1
if errorlevel 1 (
    echo ‚ùå Node.js –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js
    goto :error
)

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º npm
npm --version >nul 2>&1
if errorlevel 1 (
    echo ‚ùå npm –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ npm
    goto :error
)

:: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π npm...
npm install
if errorlevel 1 (
    echo ‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π npm
    goto :error
)

:: –ó–∞–ø—É—Å–∫–∞–µ–º frontend –≤ —Ñ–æ–Ω–µ
echo üé® –ó–∞–ø—É—Å–∫ Nuxt.js —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ http://localhost:3000
start /b cmd /c "npm run dev -- --host 0.0.0.0 --port 3000"

:: –ü–µ—Ä–µ—Ö–æ–¥–∏–º –æ–±—Ä–∞—Ç–Ω–æ –≤ –∫–æ—Ä–µ–Ω—å
cd ..
echo.

echo üéâ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–æ!
echo =================================
echo üåê Frontend: http://localhost:3000
echo üîß Backend:  http://localhost:8000
echo ‚öôÔ∏è  –ê–¥–º–∏–Ω–∫–∞: http://localhost:8000/admin
echo üì° API:      http://localhost:8000/api/
echo.
echo üìã –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C –∏–ª–∏ –∑–∞–∫—Ä–æ–π—Ç–µ —ç—Ç–æ –æ–∫–Ω–æ
echo.

:: –û–∂–∏–¥–∞–Ω–∏–µ (–ø–∞—É–∑–∞ –¥–æ –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à–∏)
pause
goto :end

:error
echo.
echo ‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è!
echo –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É.
pause
exit /b 1

:end
exit /b 0
